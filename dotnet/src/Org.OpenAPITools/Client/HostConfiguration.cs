/*
 * v2 API
 *
 * OpenAPI spec for Solr's v2 API endpoints
 *
 * The version of the OpenAPI document: 9.8.1
 * Generated by: https://github.com/openapitools/openapi-generator.git
 */

#nullable enable

using System;
using System.Collections.Generic;
using System.Linq;
using System.Text.Json;
using System.Text.Json.Serialization;
using System.Net.Http;
using Microsoft.Extensions.DependencyInjection;
using Org.OpenAPITools.Api;
using Org.OpenAPITools.Model;

namespace Org.OpenAPITools.Client
{
    /// <summary>
    /// Provides hosting configuration for Org.OpenAPITools
    /// </summary>
    public class HostConfiguration
    {
        private readonly IServiceCollection _services;
        private readonly JsonSerializerOptions _jsonOptions = new JsonSerializerOptions();

        internal bool HttpClientsAdded { get; private set; }

        /// <summary>
        /// Instantiates the class 
        /// </summary>
        /// <param name="services"></param>
        public HostConfiguration(IServiceCollection services)
        {
            _services = services;
            _jsonOptions.Converters.Add(new JsonStringEnumConverter());
            _jsonOptions.Converters.Add(new DateTimeJsonConverter());
            _jsonOptions.Converters.Add(new DateTimeNullableJsonConverter());
            _jsonOptions.Converters.Add(new DateOnlyJsonConverter());
            _jsonOptions.Converters.Add(new DateOnlyNullableJsonConverter());
            _jsonOptions.Converters.Add(new AddReplicaPropertyRequestBodyJsonConverter());
            _jsonOptions.Converters.Add(new BackupDeletionDataJsonConverter());
            _jsonOptions.Converters.Add(new BackupDeletionResponseBodyJsonConverter());
            _jsonOptions.Converters.Add(new BalanceReplicasRequestBodyJsonConverter());
            _jsonOptions.Converters.Add(new BalanceShardUniqueRequestBodyJsonConverter());
            _jsonOptions.Converters.Add(new CategoryRoutedAliasPropertiesJsonConverter());
            _jsonOptions.Converters.Add(new CollectionBackupDetailsJsonConverter());
            _jsonOptions.Converters.Add(new CreateAliasRequestBodyJsonConverter());
            _jsonOptions.Converters.Add(new CreateCollectionBackupRequestBodyJsonConverter());
            _jsonOptions.Converters.Add(new CreateCollectionRequestBodyJsonConverter());
            _jsonOptions.Converters.Add(new CreateCollectionRouterPropertiesJsonConverter());
            _jsonOptions.Converters.Add(new CreateCollectionSnapshotRequestBodyJsonConverter());
            _jsonOptions.Converters.Add(new CreateCollectionSnapshotResponseJsonConverter());
            _jsonOptions.Converters.Add(new CreateCoreBackupRequestBodyJsonConverter());
            _jsonOptions.Converters.Add(new CreateCoreSnapshotResponseJsonConverter());
            _jsonOptions.Converters.Add(new CreateReplicaRequestBodyJsonConverter());
            _jsonOptions.Converters.Add(new CreateShardRequestBodyJsonConverter());
            _jsonOptions.Converters.Add(new DeleteCollectionSnapshotResponseJsonConverter());
            _jsonOptions.Converters.Add(new DeleteNodeRequestBodyJsonConverter());
            _jsonOptions.Converters.Add(new DeleteSnapshotResponseJsonConverter());
            _jsonOptions.Converters.Add(new ErrorInfoJsonConverter());
            _jsonOptions.Converters.Add(new ErrorMetadataJsonConverter());
            _jsonOptions.Converters.Add(new FileListResponseJsonConverter());
            _jsonOptions.Converters.Add(new FileListResponseExceptionJsonConverter());
            _jsonOptions.Converters.Add(new FileListResponseExceptionCauseJsonConverter());
            _jsonOptions.Converters.Add(new FileListResponseExceptionCauseStackTraceInnerJsonConverter());
            _jsonOptions.Converters.Add(new FileMetaDataJsonConverter());
            _jsonOptions.Converters.Add(new FlexibleSolrJerseyResponseJsonConverter());
            _jsonOptions.Converters.Add(new GetAliasByNameResponseJsonConverter());
            _jsonOptions.Converters.Add(new GetAliasPropertyResponseJsonConverter());
            _jsonOptions.Converters.Add(new GetAllAliasPropertiesResponseJsonConverter());
            _jsonOptions.Converters.Add(new GetNodeCommandStatusResponseJsonConverter());
            _jsonOptions.Converters.Add(new IndexTypeJsonConverter());
            _jsonOptions.Converters.Add(new IndexTypeNullableJsonConverter());
            _jsonOptions.Converters.Add(new IndexVersionResponseJsonConverter());
            _jsonOptions.Converters.Add(new InstallCoreDataRequestBodyJsonConverter());
            _jsonOptions.Converters.Add(new InstallShardDataRequestBodyJsonConverter());
            _jsonOptions.Converters.Add(new ListAliasesResponseJsonConverter());
            _jsonOptions.Converters.Add(new ListClusterPropertiesResponseJsonConverter());
            _jsonOptions.Converters.Add(new ListCollectionBackupsResponseJsonConverter());
            _jsonOptions.Converters.Add(new ListCollectionSnapshotsResponseJsonConverter());
            _jsonOptions.Converters.Add(new ListCollectionsResponseJsonConverter());
            _jsonOptions.Converters.Add(new ListConfigsetsResponseJsonConverter());
            _jsonOptions.Converters.Add(new ListCoreSnapshotsResponseJsonConverter());
            _jsonOptions.Converters.Add(new ListLevelsResponseJsonConverter());
            _jsonOptions.Converters.Add(new LogLevelChangeJsonConverter());
            _jsonOptions.Converters.Add(new LogLevelInfoJsonConverter());
            _jsonOptions.Converters.Add(new LogMessageInfoJsonConverter());
            _jsonOptions.Converters.Add(new LogMessagesResponseJsonConverter());
            _jsonOptions.Converters.Add(new LoggingResponseJsonConverter());
            _jsonOptions.Converters.Add(new MergeIndexesRequestBodyJsonConverter());
            _jsonOptions.Converters.Add(new MigrateReplicasRequestBodyJsonConverter());
            _jsonOptions.Converters.Add(new PublicKeyResponseJsonConverter());
            _jsonOptions.Converters.Add(new PurgeUnusedFilesRequestBodyJsonConverter());
            _jsonOptions.Converters.Add(new PurgeUnusedResponseJsonConverter());
            _jsonOptions.Converters.Add(new PurgeUnusedStatsJsonConverter());
            _jsonOptions.Converters.Add(new ReloadCollectionRequestBodyJsonConverter());
            _jsonOptions.Converters.Add(new ReloadCoreRequestBodyJsonConverter());
            _jsonOptions.Converters.Add(new RenameCollectionRequestBodyJsonConverter());
            _jsonOptions.Converters.Add(new RenameCoreRequestBodyJsonConverter());
            _jsonOptions.Converters.Add(new ReplaceNodeRequestBodyJsonConverter());
            _jsonOptions.Converters.Add(new ReplicationBackupRequestBodyJsonConverter());
            _jsonOptions.Converters.Add(new ReplicationBackupResponseJsonConverter());
            _jsonOptions.Converters.Add(new ResponseHeaderJsonConverter());
            _jsonOptions.Converters.Add(new RestoreCollectionRequestBodyJsonConverter());
            _jsonOptions.Converters.Add(new RestoreCoreRequestBodyJsonConverter());
            _jsonOptions.Converters.Add(new RoutedAliasPropertiesJsonConverter());
            _jsonOptions.Converters.Add(new ScaleCollectionRequestBodyJsonConverter());
            _jsonOptions.Converters.Add(new SchemaGetDynamicFieldInfoResponseJsonConverter());
            _jsonOptions.Converters.Add(new SchemaGetFieldInfoResponseJsonConverter());
            _jsonOptions.Converters.Add(new SchemaGetFieldTypeInfoResponseJsonConverter());
            _jsonOptions.Converters.Add(new SchemaInfoResponseJsonConverter());
            _jsonOptions.Converters.Add(new SchemaListCopyFieldsResponseJsonConverter());
            _jsonOptions.Converters.Add(new SchemaListDynamicFieldsResponseJsonConverter());
            _jsonOptions.Converters.Add(new SchemaListFieldTypesResponseJsonConverter());
            _jsonOptions.Converters.Add(new SchemaListFieldsResponseJsonConverter());
            _jsonOptions.Converters.Add(new SchemaNameResponseJsonConverter());
            _jsonOptions.Converters.Add(new SchemaSimilarityResponseJsonConverter());
            _jsonOptions.Converters.Add(new SchemaUniqueKeyResponseJsonConverter());
            _jsonOptions.Converters.Add(new SchemaVersionResponseJsonConverter());
            _jsonOptions.Converters.Add(new SchemaZkVersionResponseJsonConverter());
            _jsonOptions.Converters.Add(new SetClusterPropertyRequestBodyJsonConverter());
            _jsonOptions.Converters.Add(new SetThresholdRequestBodyJsonConverter());
            _jsonOptions.Converters.Add(new SnapshotInformationJsonConverter());
            _jsonOptions.Converters.Add(new SolrJerseyResponseJsonConverter());
            _jsonOptions.Converters.Add(new SubResponseAccumulatingJerseyResponseJsonConverter());
            _jsonOptions.Converters.Add(new SwapCoresRequestBodyJsonConverter());
            _jsonOptions.Converters.Add(new TimeRoutedAliasPropertiesJsonConverter());
            _jsonOptions.Converters.Add(new UnloadCoreRequestBodyJsonConverter());
            _jsonOptions.Converters.Add(new UpdateAliasPropertiesRequestBodyJsonConverter());
            _jsonOptions.Converters.Add(new UpdateAliasPropertyRequestBodyJsonConverter());
            _jsonOptions.Converters.Add(new UpdateCollectionPropertyRequestBodyJsonConverter());
            _jsonOptions.Converters.Add(new UploadToFileStoreResponseJsonConverter());
            _jsonOptions.Converters.Add(new ZooKeeperFileResponseJsonConverter());
            _jsonOptions.Converters.Add(new ZooKeeperListChildrenResponseJsonConverter());
            _jsonOptions.Converters.Add(new ZooKeeperStatJsonConverter());
            JsonSerializerOptionsProvider jsonSerializerOptionsProvider = new(_jsonOptions);
            _services.AddSingleton(jsonSerializerOptionsProvider);
            _services.AddSingleton<IApiFactory, ApiFactory>();
            _services.AddSingleton<AliasPropertiesApiEvents>();
            _services.AddTransient<IAliasPropertiesApi, AliasPropertiesApi>();
            _services.AddSingleton<AliasesApiEvents>();
            _services.AddTransient<IAliasesApi, AliasesApi>();
            _services.AddSingleton<ClusterApiEvents>();
            _services.AddTransient<IClusterApi, ClusterApi>();
            _services.AddSingleton<ClusterPropertiesApiEvents>();
            _services.AddTransient<IClusterPropertiesApi, ClusterPropertiesApi>();
            _services.AddSingleton<CollectionBackupsApiEvents>();
            _services.AddTransient<ICollectionBackupsApi, CollectionBackupsApi>();
            _services.AddSingleton<CollectionPropertiesApiEvents>();
            _services.AddTransient<ICollectionPropertiesApi, CollectionPropertiesApi>();
            _services.AddSingleton<CollectionSnapshotsApiEvents>();
            _services.AddTransient<ICollectionSnapshotsApi, CollectionSnapshotsApi>();
            _services.AddSingleton<CollectionsApiEvents>();
            _services.AddTransient<ICollectionsApi, CollectionsApi>();
            _services.AddSingleton<ConfigsetsApiEvents>();
            _services.AddTransient<IConfigsetsApi, ConfigsetsApi>();
            _services.AddSingleton<CoreBackupsApiEvents>();
            _services.AddTransient<ICoreBackupsApi, CoreBackupsApi>();
            _services.AddSingleton<CoreReplicationApiEvents>();
            _services.AddTransient<ICoreReplicationApi, CoreReplicationApi>();
            _services.AddSingleton<CoreSnapshotsApiEvents>();
            _services.AddTransient<ICoreSnapshotsApi, CoreSnapshotsApi>();
            _services.AddSingleton<CoresApiEvents>();
            _services.AddTransient<ICoresApi, CoresApi>();
            _services.AddSingleton<DefaultApiEvents>();
            _services.AddTransient<IDefaultApi, DefaultApi>();
            _services.AddSingleton<FileStoreApiEvents>();
            _services.AddTransient<IFileStoreApi, FileStoreApi>();
            _services.AddSingleton<LoggingApiEvents>();
            _services.AddTransient<ILoggingApi, LoggingApi>();
            _services.AddSingleton<NodeApiEvents>();
            _services.AddTransient<INodeApi, NodeApi>();
            _services.AddSingleton<QueryingApiEvents>();
            _services.AddTransient<IQueryingApi, QueryingApi>();
            _services.AddSingleton<ReplicaPropertiesApiEvents>();
            _services.AddTransient<IReplicaPropertiesApi, ReplicaPropertiesApi>();
            _services.AddSingleton<ReplicasApiEvents>();
            _services.AddTransient<IReplicasApi, ReplicasApi>();
            _services.AddSingleton<ReplicationApiEvents>();
            _services.AddTransient<IReplicationApi, ReplicationApi>();
            _services.AddSingleton<ReplicationBackupsApiEvents>();
            _services.AddTransient<IReplicationBackupsApi, ReplicationBackupsApi>();
            _services.AddSingleton<SchemaApiEvents>();
            _services.AddTransient<ISchemaApi, SchemaApi>();
            _services.AddSingleton<ShardsApiEvents>();
            _services.AddTransient<IShardsApi, ShardsApi>();
            _services.AddSingleton<ZookeeperReadApiEvents>();
            _services.AddTransient<IZookeeperReadApi, ZookeeperReadApi>();
        }

        /// <summary>
        /// Configures the HttpClients.
        /// </summary>
        /// <param name="client"></param>
        /// <param name="builder"></param>
        /// <returns></returns>
        public HostConfiguration AddApiHttpClients
        (
            Action<HttpClient>? client = null, Action<IHttpClientBuilder>? builder = null)
        {
            if (client == null)
                client = c => c.BaseAddress = new Uri(ClientUtils.BASE_ADDRESS);

            List<IHttpClientBuilder> builders = new List<IHttpClientBuilder>();

            builders.Add(_services.AddHttpClient<IAliasPropertiesApi, AliasPropertiesApi>(client));
            builders.Add(_services.AddHttpClient<IAliasesApi, AliasesApi>(client));
            builders.Add(_services.AddHttpClient<IClusterApi, ClusterApi>(client));
            builders.Add(_services.AddHttpClient<IClusterPropertiesApi, ClusterPropertiesApi>(client));
            builders.Add(_services.AddHttpClient<ICollectionBackupsApi, CollectionBackupsApi>(client));
            builders.Add(_services.AddHttpClient<ICollectionPropertiesApi, CollectionPropertiesApi>(client));
            builders.Add(_services.AddHttpClient<ICollectionSnapshotsApi, CollectionSnapshotsApi>(client));
            builders.Add(_services.AddHttpClient<ICollectionsApi, CollectionsApi>(client));
            builders.Add(_services.AddHttpClient<IConfigsetsApi, ConfigsetsApi>(client));
            builders.Add(_services.AddHttpClient<ICoreBackupsApi, CoreBackupsApi>(client));
            builders.Add(_services.AddHttpClient<ICoreReplicationApi, CoreReplicationApi>(client));
            builders.Add(_services.AddHttpClient<ICoreSnapshotsApi, CoreSnapshotsApi>(client));
            builders.Add(_services.AddHttpClient<ICoresApi, CoresApi>(client));
            builders.Add(_services.AddHttpClient<IDefaultApi, DefaultApi>(client));
            builders.Add(_services.AddHttpClient<IFileStoreApi, FileStoreApi>(client));
            builders.Add(_services.AddHttpClient<ILoggingApi, LoggingApi>(client));
            builders.Add(_services.AddHttpClient<INodeApi, NodeApi>(client));
            builders.Add(_services.AddHttpClient<IQueryingApi, QueryingApi>(client));
            builders.Add(_services.AddHttpClient<IReplicaPropertiesApi, ReplicaPropertiesApi>(client));
            builders.Add(_services.AddHttpClient<IReplicasApi, ReplicasApi>(client));
            builders.Add(_services.AddHttpClient<IReplicationApi, ReplicationApi>(client));
            builders.Add(_services.AddHttpClient<IReplicationBackupsApi, ReplicationBackupsApi>(client));
            builders.Add(_services.AddHttpClient<ISchemaApi, SchemaApi>(client));
            builders.Add(_services.AddHttpClient<IShardsApi, ShardsApi>(client));
            builders.Add(_services.AddHttpClient<IZookeeperReadApi, ZookeeperReadApi>(client));
            
            if (builder != null)
                foreach (IHttpClientBuilder instance in builders)
                    builder(instance);

            HttpClientsAdded = true;

            return this;
        }

        /// <summary>
        /// Configures the JsonSerializerSettings
        /// </summary>
        /// <param name="options"></param>
        /// <returns></returns>
        public HostConfiguration ConfigureJsonOptions(Action<JsonSerializerOptions> options)
        {
            options(_jsonOptions);

            return this;
        }

        /// <summary>
        /// Adds tokens to your IServiceCollection
        /// </summary>
        /// <typeparam name="TTokenBase"></typeparam>
        /// <param name="token"></param>
        /// <returns></returns>
        public HostConfiguration AddTokens<TTokenBase>(TTokenBase token) where TTokenBase : TokenBase
        {
            return AddTokens(new TTokenBase[]{ token });
        }

        /// <summary>
        /// Adds tokens to your IServiceCollection
        /// </summary>
        /// <typeparam name="TTokenBase"></typeparam>
        /// <param name="tokens"></param>
        /// <returns></returns>
        public HostConfiguration AddTokens<TTokenBase>(IEnumerable<TTokenBase> tokens) where TTokenBase : TokenBase
        {
            TokenContainer<TTokenBase> container = new TokenContainer<TTokenBase>(tokens);
            _services.AddSingleton(services => container);

            return this;
        }

        /// <summary>
        /// Adds a token provider to your IServiceCollection
        /// </summary>
        /// <typeparam name="TTokenProvider"></typeparam>
        /// <typeparam name="TTokenBase"></typeparam>
        /// <returns></returns>
        public HostConfiguration UseProvider<TTokenProvider, TTokenBase>() 
            where TTokenProvider : TokenProvider<TTokenBase>
            where TTokenBase : TokenBase
        {
            _services.AddSingleton<TTokenProvider>();
            _services.AddSingleton<TokenProvider<TTokenBase>>(services => services.GetRequiredService<TTokenProvider>());

            return this;
        }
    }
}
